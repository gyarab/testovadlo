#!/bin/bash

[[ -f /data/.mainclass ]] ||  { echo -e "\n$ java\nChyba: program není možno spustit, neboť se jej nepodařilo zkompilovat"; exit 11; }
[[ $(cat /data/.mainclass | wc -l) -ne 0 ]] ||  { echo -e "\n$ java ...\nChyba: program není možno spustit, neboť chybí metoda main()"; exit 11; }
main=$(head -1 /data/.mainclass)

echo "$ java $main   # timeout 15s"

out1=$(cd /data/build; timeout --foreground 15 java "$main") || true
head <<<"$out1"
echo "..."

if grep -q 'nema pribor' <<<"$out1"
then
	grep 'nema pribor' <<<"$out1" | head
	echo -e "\nChyba: jíst bez příboru se nesmí!"
	exit 11
fi

if grep -q 'ktera neni jeho' <<<"$out1"
then
	grep 'ktera neni jeho' <<<"$out1" | head
	echo -e "\nChyba: zloděj, chyťe ho!!!"
	exit 11
fi

test1=$(sort <<<"$out1" | grep ' obedva$' | uniq -c | head)

echo "Statistika najedenosti:"
cat <<<"$test1"
